<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Abhraneel Sarma" />

<meta name="date" content="2024-10-07" />

<title>Declaring conditions in the multiverse</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Declaring conditions in the multiverse</h1>
<h4 class="author">Abhraneel Sarma</h4>
<h4 class="date">2024-10-07</h4>


<div id="TOC">
<ul>
<li><a href="#the-data" id="toc-the-data">The data</a></li>
<li><a href="#specifying-conditions-in-the-multiverse-analysis" id="toc-specifying-conditions-in-the-multiverse-analysis">Specifying
conditions in the multiverse analysis</a></li>
<li><a href="#implementing-conditions-in-a-complete-analysis" id="toc-implementing-conditions-in-a-complete-analysis">Implementing
conditions in a complete analysis</a></li>
</ul>
</div>

<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(multiverse)</span></code></pre></div>
<div id="the-data" class="section level2">
<h2>The data</h2>
<p>We will be using the same data as the vignette: <em>A complete
implementation of a multiverse analysis</em> (see
<code>vignette(&quot;complete-multiverse-analysis&quot;)</code>).</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;durante&quot;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>df_durante <span class="ot">&lt;-</span> durante <span class="sc">|&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>    <span class="at">Abortion =</span> <span class="fu">abs</span>(<span class="dv">7</span> <span class="sc">-</span> Abortion) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>    <span class="at">StemCell =</span> <span class="fu">abs</span>(<span class="dv">7</span> <span class="sc">-</span> StemCell) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>    <span class="at">Marijuana =</span> <span class="fu">abs</span>(<span class="dv">7</span> <span class="sc">-</span> Marijuana) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>    <span class="at">RichTax =</span> <span class="fu">abs</span>(<span class="dv">7</span> <span class="sc">-</span> RichTax) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>    <span class="at">StLiving =</span> <span class="fu">abs</span>(<span class="dv">7</span> <span class="sc">-</span> StLiving) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>    <span class="at">Profit =</span> <span class="fu">abs</span>(<span class="dv">7</span> <span class="sc">-</span> Profit) <span class="sc">+</span> <span class="dv">1</span>,</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>    <span class="at">FiscConsComp =</span> FreeMarket <span class="sc">+</span> PrivSocialSec <span class="sc">+</span> RichTax <span class="sc">+</span> StLiving <span class="sc">+</span> Profit,</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>    <span class="at">SocConsComp =</span> Marriage <span class="sc">+</span> RestrictAbortion <span class="sc">+</span> Abortion <span class="sc">+</span> StemCell <span class="sc">+</span> Marijuana</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>  )</span></code></pre></div>
</div>
<div id="specifying-conditions-in-the-multiverse-analysis" class="section level2">
<h2>Specifying conditions in the multiverse analysis</h2>
<p>In a multiverse analysis, it may occur that the value of one variable
might depend on the value of another variable defined previously. For
example, in our example, we are excluding participants based on their
<em>cycle length</em>. This can be done in two ways: we can use the
values of the variable,<code>ComputedCycleLength</code> or
<code>ReportedCycleLength</code>. If we are using
<code>ComputedCycleLength</code> to exclude participants, this means
that we should not calculate the variable
<code>NextMenstrualOnset</code> (date for the onset of the next
menstrual cycle) using the <code>ReportedCycleLength</code> value.
Similarly, if we are using <code>ReportedCycleLength</code> to exclude
participants it is inconsistent to calculate
<code>NextMenstrualOnset</code> using
<code>ComputedCycleLength</code>.</p>
<p>We should be able to express these conditions in the multiverse. We
can do this in two ways: 1. <code>%when%</code>: when declaring a
branch, we can use this operator to specify the conditional <span class="math inline">\(A | B\)</span> as <code>A %when% B</code>. The
conditional <span class="math inline">\(A | B\)</span> is also referred
to as the connective <span class="math inline">\(A \implies B\)</span>.
This has the meaning “if A is true, then B is also true” and is an
abbreviation for <span class="math inline">\(\neg A | B\)</span> 2.
<code>branch_assert</code>: this function allows the user to specify any
condition in the form of a logical operation</p>
<div id="the-when-operator" class="section level4">
<h4>The <code>%when%</code> operator</h4>
<p>There are two ways in which you can specify the <code>%when%</code>
operator. The first is to specify it at the end of the branch. This will
work even if you omit the branch option name.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">NextMenstrualOnset =</span> <span class="fu">branch</span>(menstrual_calculation,</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>        <span class="st">&quot;mc_option1&quot;</span> <span class="sc">~</span> (StartDateofLastPeriod <span class="sc">+</span> ComputedCycleLength) <span class="sc">%when%</span> (cycle_length <span class="sc">!=</span> <span class="st">&quot;cl_option3&quot;</span>),</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>        <span class="st">&quot;mc_option2&quot;</span> <span class="sc">~</span> (StartDateofLastPeriod <span class="sc">+</span> ReportedCycleLength) <span class="sc">%when%</span> (cycle_length <span class="sc">!=</span> <span class="st">&quot;cl_option2&quot;</span>),</span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>        <span class="st">&quot;mc_option3&quot;</span> <span class="sc">~</span> StartDateNext)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>    )</span></code></pre></div>
<p>The other is to specify it at the head of the branch, right after the
option name:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">NextMenstrualOnset =</span> <span class="fu">branch</span>(menstrual_calculation,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>        <span class="st">&quot;mc_option1&quot;</span> <span class="sc">%when%</span> (cycle_length <span class="sc">!=</span> <span class="st">&quot;cl_option3&quot;</span>) <span class="sc">~</span> StartDateofLastPeriod <span class="sc">+</span> ComputedCycleLength,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>        <span class="st">&quot;mc_option2&quot;</span> <span class="sc">%when%</span> (cycle_length <span class="sc">!=</span> <span class="st">&quot;cl_option2&quot;</span>) <span class="sc">~</span> (StartDateofLastPeriod <span class="sc">+</span> ReportedCycleLength),</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>        <span class="st">&quot;mc_option3&quot;</span> <span class="sc">~</span> StartDateNext)</span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>    )</span></code></pre></div>
<p><strong>Note</strong>: In this example we will be using the
<code>inside</code> syntax to enter code into the multiverse, instead of
<em>multiverse code blocks</em> to highlight the syntax of the
conditional declaration as <em>multiverse code blocks</em> shows the
code for a universe, and hides the actual code declared by the user.</p>
<p>We can write the complete analysis by specifying the condition with
the %when% operator as:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>M <span class="ot">=</span> <span class="fu">multiverse</span>()</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a><span class="fu">inside</span>(M, {</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  df<span class="fl">.1</span> <span class="ot">&lt;-</span> df_durante  <span class="sc">|&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>      <span class="fu">mutate</span>( <span class="at">ComputedCycleLength =</span> StartDateofLastPeriod <span class="sc">-</span> StartDateofPeriodBeforeLast )  <span class="sc">|&gt;</span></span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>( <span class="fu">branch</span>(cycle_length,</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>          <span class="st">&quot;cl_option1&quot;</span> <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>          <span class="st">&quot;cl_option2&quot;</span> <span class="sc">~</span> ComputedCycleLength <span class="sc">&gt;</span> <span class="dv">25</span> <span class="sc">&amp;</span> ComputedCycleLength <span class="sc">&lt;</span> <span class="dv">35</span>,</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>          <span class="st">&quot;cl_option3&quot;</span> <span class="sc">~</span> ReportedCycleLength <span class="sc">&gt;</span> <span class="dv">25</span> <span class="sc">&amp;</span> ReportedCycleLength <span class="sc">&lt;</span> <span class="dv">35</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>      )) <span class="sc">|&gt;</span></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">NextMenstrualOnset =</span> <span class="fu">branch</span>(menstrual_calculation,</span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>          <span class="st">&quot;mc_option1&quot;</span> <span class="sc">%when%</span> (cycle_length <span class="sc">!=</span> <span class="st">&quot;cl_option3&quot;</span>) <span class="sc">~</span> StartDateofLastPeriod <span class="sc">+</span> ComputedCycleLength,</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>          <span class="st">&quot;mc_option2&quot;</span> <span class="sc">%when%</span> (cycle_length <span class="sc">!=</span> <span class="st">&quot;cl_option2&quot;</span>) <span class="sc">~</span> StartDateofLastPeriod <span class="sc">+</span> ReportedCycleLength,</span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>          <span class="st">&quot;mc_option3&quot;</span> <span class="sc">~</span> StartDateNext)</span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>      )</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>})</span></code></pre></div>
<p>In <code>multiverse code chunks</code> conditionals can be declared
in pretty much the same way:</p>
<pre><code>```{multiverse default-m-1, inside = M}
df &lt;- df_durante  |&gt;
      mutate( ComputedCycleLength = StartDateofLastPeriod - StartDateofPeriodBeforeLast )  |&gt;
      dplyr::filter( branch(cycle_length,
          &quot;cl_option1&quot; ~ TRUE,
          &quot;cl_option2&quot; ~ ComputedCycleLength &gt; 25 &amp; ComputedCycleLength &lt; 35,
          &quot;cl_option3&quot; ~ ReportedCycleLength &gt; 25 &amp; ReportedCycleLength &lt; 35
      )) |&gt;
      mutate(NextMenstrualOnset = branch(menstrual_calculation,
          &quot;mc_option1&quot; %when% (cycle_length != &quot;cl_option3&quot;) ~ StartDateofLastPeriod + ComputedCycleLength,
          &quot;mc_option2&quot; %when% (cycle_length != &quot;cl_option2&quot;) ~ StartDateofLastPeriod + ReportedCycleLength,
          &quot;mc_option3&quot; ~ StartDateNext)
      )
```</code></pre>
<p><strong>Note</strong>: in this vignette we used the script-oriented
<code>inside()</code> function for implementing the multiverse. However,
we can implement the exact same multiverse in RMarkdown using the
<code>multiverse-code-block</code> for more interactive programming. To
implement this using a <code>multiverse-code-block</code>, we can simply
place the code passed into the inside function (the second argument)
inside a code block of type <code>multiverse</code>, provide it with the
appropriate labels and multiverse object, and execute it. See
(multiverse-in-rmd) and (branch) for more details and examples.</p>
<p>As the condition implies, the parameter
<code>menstrual_calcaultion</code> (which is for calculating the
variable <code>NextMenstrualCalculation</code>) cannot take the value of
“mc_option1” when we filter <code>cycle_length</code> using
“cl_option3”. Similarly, <code>menstrual_calcaultion</code> cannot take
the value of “mc_option2” when we filter <code>cycle_length</code> using
“cl_option2”. In the multiverse table below, you can see that those two
parameter combinations are absent (universes indexed 3 and 5.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">expand</span>(M)</span></code></pre></div>
<pre><code>## # A tibble: 7 × 7
##   .universe cycle_length menstrual_calculation .parameter_assignment
##       &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;                 &lt;list&gt;               
## 1         1 cl_option1   mc_option1            &lt;named list [2]&gt;     
## 2         2 cl_option1   mc_option2            &lt;named list [2]&gt;     
## 3         3 cl_option1   mc_option3            &lt;named list [2]&gt;     
## 4         4 cl_option2   mc_option1            &lt;named list [2]&gt;     
## 5         5 cl_option2   mc_option3            &lt;named list [2]&gt;     
## 6         6 cl_option3   mc_option2            &lt;named list [2]&gt;     
## 7         7 cl_option3   mc_option3            &lt;named list [2]&gt;     
## # ℹ 3 more variables: .code &lt;list&gt;, .results &lt;list&gt;, .errors &lt;list&gt;</code></pre>
</div>
<div id="the-branch_assert-function" class="section level4">
<h4>The <code>branch_assert()</code> function</h4>
<p>The same can be performed with the <code>branch_assert()</code>
function. The benefit of using this is that within the branch assert
function, the user can specify any logical operation.</p>
<p>For eg: the above logical operations can be specified as:
<code>branch_assert((menstrual_calculation != &quot;mc_option1&quot; | cycle_length != &quot;cl_option3&quot;))</code></p>
<p>Both these operations have the same result, but the first may not be
as easily interpretable. We specify the conditionals using the
<code>branch_assert()</code> function in our example as:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>df <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>    <span class="fu">branch_assert</span>( (menstrual_calculation <span class="sc">!=</span> <span class="st">&quot;mc_option1&quot;</span> <span class="sc">|</span> (cycle_length <span class="sc">!=</span> <span class="st">&quot;cl_option3&quot;</span>)) ) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>    <span class="fu">branch_assert</span>( (menstrual_calculation <span class="sc">!=</span> <span class="st">&quot;mc_option2&quot;</span> <span class="sc">|</span> (cycle_length <span class="sc">!=</span> <span class="st">&quot;cl_option2&quot;</span>)) )</span></code></pre></div>
<p>Using the <code>branch_assert()</code>, we can perform the exact same
analysis:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>M <span class="ot">=</span> <span class="fu">multiverse</span>()</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="fu">inside</span>(M, {</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>    df<span class="fl">.2</span> <span class="ot">&lt;-</span> df_durante  <span class="sc">|&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>        <span class="fu">mutate</span>( <span class="at">ComputedCycleLength =</span> StartDateofLastPeriod <span class="sc">-</span> StartDateofPeriodBeforeLast )  <span class="sc">|&gt;</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>        <span class="fu">filter</span>( <span class="fu">branch</span>(cycle_length,</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>            <span class="st">&quot;cl_option1&quot;</span> <span class="sc">~</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>            <span class="st">&quot;cl_option2&quot;</span> <span class="sc">~</span> ComputedCycleLength <span class="sc">&gt;</span> <span class="dv">25</span> <span class="sc">&amp;</span> ComputedCycleLength <span class="sc">&lt;</span> <span class="dv">35</span>,</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>            <span class="st">&quot;cl_option3&quot;</span> <span class="sc">~</span> ReportedCycleLength <span class="sc">&gt;</span> <span class="dv">25</span> <span class="sc">&amp;</span> ReportedCycleLength <span class="sc">&lt;</span> <span class="dv">35</span></span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>        )) <span class="sc">|&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">NextMenstrualOnset =</span> <span class="fu">branch</span>(menstrual_calculation,</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>            <span class="st">&quot;mc_option1&quot;</span> <span class="sc">~</span> StartDateofLastPeriod <span class="sc">+</span> ComputedCycleLength,</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a>            <span class="st">&quot;mc_option2&quot;</span> <span class="sc">~</span> StartDateofLastPeriod <span class="sc">+</span> ReportedCycleLength,</span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a>            <span class="st">&quot;mc_option3&quot;</span> <span class="sc">~</span> StartDateNext)</span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>        <span class="fu">branch_assert</span>( (menstrual_calculation <span class="sc">!=</span> <span class="st">&quot;mc_option1&quot;</span> <span class="sc">|</span> (cycle_length <span class="sc">!=</span> <span class="st">&quot;cl_option3&quot;</span>)) ) <span class="sc">|&gt;</span></span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>        <span class="fu">branch_assert</span>( (menstrual_calculation <span class="sc">!=</span> <span class="st">&quot;mc_option2&quot;</span> <span class="sc">|</span> (cycle_length <span class="sc">!=</span> <span class="st">&quot;cl_option2&quot;</span>)) )</span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>})</span></code></pre></div>
<pre><code>## Warning in FUN(X[[i]], ...): error in universe 1</code></pre>
<pre><code>## 
##  Error in FUN(X[[i]], ...) : object &#39;df.2&#39; not found
##  tools::buildVignettes -&gt; engine$weave -&gt; vweave_rmarkdown -&gt; rmarkdown::render -&gt; knitr::knit -&gt; process_file -&gt; xfun:::handle_error -&gt; withCallingHandlers -&gt; process_group -&gt; call_block -&gt; block_exec -&gt; eng_r -&gt; in_input_dir -&gt; in_dir -&gt; evaluate -&gt; evaluate::evaluate -&gt; withRestarts -&gt; withRestartList -&gt; withOneRestart -&gt; withRestartList -&gt; withOneRestart -&gt; withRestartList -&gt; withOneRestart -&gt; with_handlers -&gt; eval -&gt; eval -&gt; withCallingHandlers -&gt; withVisible -&gt; eval -&gt; eval -&gt; inside -&gt; execute_universe -&gt; lapply -&gt; FUN -&gt; tryStack -&gt; lapply -&gt; FUN -&gt; FUN -&gt; FUN(X[[i]], ...)</code></pre>
<p>As we can see, this results in the same multiverse, where universes
indexed 3 and 5 are not compatible.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">expand</span>(M)</span></code></pre></div>
<pre><code>## # A tibble: 7 × 7
##   .universe cycle_length menstrual_calculation .parameter_assignment
##       &lt;int&gt; &lt;chr&gt;        &lt;chr&gt;                 &lt;list&gt;               
## 1         1 cl_option1   mc_option1            &lt;named list [2]&gt;     
## 2         2 cl_option1   mc_option2            &lt;named list [2]&gt;     
## 3         3 cl_option1   mc_option3            &lt;named list [2]&gt;     
## 4         4 cl_option2   mc_option1            &lt;named list [2]&gt;     
## 5         5 cl_option2   mc_option3            &lt;named list [2]&gt;     
## 6         6 cl_option3   mc_option2            &lt;named list [2]&gt;     
## 7         7 cl_option3   mc_option3            &lt;named list [2]&gt;     
## # ℹ 3 more variables: .code &lt;list&gt;, .results &lt;list&gt;, .errors &lt;list&gt;</code></pre>
</div>
</div>
<div id="implementing-conditions-in-a-complete-analysis" class="section level2">
<h2>Implementing conditions in a complete analysis</h2>
<p>Specifying these conditions allows us to exclude inconsistent
combinations from our analyses. Let’s update the example from <a href="https://mucollective.github.io/multiverse/">home page</a> by
including these conditions:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>M <span class="ot">=</span> <span class="fu">multiverse</span>()</span></code></pre></div>
<pre><code>```{multiverse default-m-2, inside = M, echo = FALSE}
df &lt;- df_durante  |&gt;
  mutate( ComputedCycleLength = StartDateofLastPeriod - StartDateofPeriodBeforeLast )  |&gt;
  dplyr::filter( branch(cycle_length,
          &quot;cl_option1&quot; ~ TRUE,
          &quot;cl_option2&quot; ~ ComputedCycleLength &gt; 25 &amp; ComputedCycleLength &lt; 35,
          &quot;cl_option3&quot; ~ ReportedCycleLength &gt; 25 &amp; ReportedCycleLength &lt; 35
  )) |&gt;
  dplyr::filter( branch(certainty,
          &quot;cer_option1&quot; ~ TRUE,
          &quot;cer_option2&quot; ~ Sure1 &gt; 6 | Sure2 &gt; 6
  )) |&gt;
  mutate(NextMenstrualOnset = branch(menstrual_calculation,
          &quot;mc_option1&quot; %when% (cycle_length != &quot;cl_option3&quot;) ~ StartDateofLastPeriod + ComputedCycleLength,
          &quot;mc_option2&quot; %when% (cycle_length != &quot;cl_option2&quot;) ~ StartDateofLastPeriod + ReportedCycleLength,
          &quot;mc_option3&quot; ~ StartDateNext)
  )  |&gt;
  mutate(
    CycleDay = 28 - (NextMenstrualOnset - DateTesting),
    CycleDay = ifelse(CycleDay &gt; 1 &amp; CycleDay &lt; 28, CycleDay, ifelse(CycleDay &lt; 1, 1, 28))
  ) |&gt;
  mutate( Fertility = branch( fertile,
          &quot;fer_option1&quot; ~ factor( ifelse(CycleDay &gt;= 7 &amp; CycleDay &lt;= 14, &quot;high&quot;, ifelse(CycleDay &gt;= 17 &amp; CycleDay &lt;= 25, &quot;low&quot;, NA)) ),
          &quot;fer_option2&quot; ~ factor( ifelse(CycleDay &gt;= 6 &amp; CycleDay &lt;= 14, &quot;high&quot;, ifelse(CycleDay &gt;= 17 &amp; CycleDay &lt;= 27, &quot;low&quot;, NA)) ),
          &quot;fer_option3&quot; ~ factor( ifelse(CycleDay &gt;= 9 &amp; CycleDay &lt;= 17, &quot;high&quot;, ifelse(CycleDay &gt;= 18 &amp; CycleDay &lt;= 25, &quot;low&quot;, NA)) ),
          &quot;fer_option4&quot; ~ factor( ifelse(CycleDay &gt;= 8 &amp; CycleDay &lt;= 14, &quot;high&quot;, &quot;low&quot;) ),
          &quot;fer_option45&quot; ~ factor( ifelse(CycleDay &gt;= 8 &amp; CycleDay &lt;= 17, &quot;high&quot;, &quot;low&quot;) )
  )) |&gt;
  mutate(RelationshipStatus = branch(relationship_status,
          &quot;rs_option1&quot; ~ factor(ifelse(Relationship==1 | Relationship==2, &#39;Single&#39;, &#39;Relationship&#39;)),
          &quot;rs_option2&quot; ~ factor(ifelse(Relationship==1, &#39;Single&#39;, &#39;Relationship&#39;)),
          &quot;rs_option3&quot; ~ factor(ifelse(Relationship==1, &#39;Single&#39;, ifelse(Relationship==3 | Relationship==4, &#39;Relationship&#39;, NA))) )
  )
```</code></pre>
<p>After excluding the inconsistent choice combinations, <span class="math inline">\(270 − 2 \times (5 \times 1 \times 3 \times 1
\times 2) = 210\)</span> choice combinations remain:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">expand</span>(M) <span class="sc">|&gt;</span> <span class="fu">nrow</span>()</span></code></pre></div>
<pre><code>## [1] 210</code></pre>
<p>Now, we’ve created the complete multiverse that was presented as
example #2 from Steegen et al.’s paper.</p>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
